{"version":3,"sources":["../src/pictureit_ctrl.js"],"names":["_","MetricsPanelCtrl","kbn","panelDefaults","valueMaps","seriesList","series","bgimage","sensors","height","width","PictureItCtrl","$scope","$injector","defaults","panel","unitFormats","getUnitFormats","events","on","onInitEditMode","bind","render","onDataReceived","dataList","dataListLength","length","seriesLength","datapoints","dataVal","i","push","name","target","value","index","splice","xlocation","ylocation","format","decimals","bgcolor","color","size","bordercolor","visible","lastSensor","subItem","addEditorTab","scope","elem","attrs","ctrl","$panelContainer","find","pixelStrToNum","str","parseInt","substr","css","sensorsLength","valueMapsLength","sensor","ylocationStr","toString","xlocationStr","sizeStr","valueMap","valueFormatted","valueFormats","renderingCompleted","templateUrl"],"mappings":"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","file":"pictureit_ctrl.js","sourcesContent":["import _ from 'lodash';\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport './sprintf.js';\nimport './angular-sprintf.js';\nimport kbn from 'app/core/utils/kbn';\n\nconst panelDefaults = {\n\tvalueMaps: [],\n\tseriesList: [],\n\tseries: [],\n\tbgimage: '',\n\tsensors: [],\n\theight: '400px',\n\twidth: '100px'\n};\n\nexport class PictureItCtrl extends MetricsPanelCtrl  {\n  \n  \n  constructor($scope, $injector) {\n    super($scope, $injector);\n    _.defaults(this.panel, panelDefaults);\n\n    this.unitFormats = kbn.getUnitFormats();\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('panel-initialized', this.render.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n  }\n\n  onDataReceived(dataList) {\t\n\tvar dataListLength = dataList.length;\n\tthis.panel.valueMaps=[];\n\tfor (var series=0;series<dataListLength;series++) {\t\t\n\t\tvar seriesLength = dataList[series].datapoints.length;\n\t\tvar dataVal = dataList[series].datapoints[seriesLength-1][0];\n\t\tif (seriesLength > 1) {\n\t\t\tfor (var i=seriesLength; i>0; i--) {\n\t\t\t\tif (dataList[series].datapoints[i-1][0] != null) {\n\t\t\t\t\tdataVal = dataList[series].datapoints[i-1][0];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.panel.valueMaps.push({name:dataList[series].target,value:dataVal});\n\t}\n\t\n    this.render();\n  }\n  \n  deleteSensor(index) {\n\tthis.panel.sensors.splice(index,1);\n  }\n  \n  addSensor() {\n\tif (this.panel.sensors.length==0)\n\t\tthis.panel.sensors.push({name: 'A-series', xlocation: 200,ylocation: 200,format: 'none', decimals: 'auto',bgcolor:'rgba(0, 0, 0, 0.58)',color:'#FFFFFF',size:22, bordercolor:'rgb(251, 4, 4)',visible:true});\n\telse {\n\t\tvar lastSensor=this.panel.sensors[this.panel.sensors.length-1];\n\t\n\t\tthis.panel.sensors.push({name: lastSensor.name, xlocation: 200,ylocation: 200,format: lastSensor.format, decimals: lastSensor.decimals,bgcolor:lastSensor.bgcolor,color:lastSensor.color,size:lastSensor.size, bordercolor:lastSensor.bordercolor,visible:true});\n\t}\n  }\n  \n  setUnitFormat(subItem, index) {\n  \tthis.panel.sensors[index].format = subItem.value;\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/bessler-pictureit-panel/editor.html', 2);\n  }\n\t\n  link(scope, elem, attrs, ctrl) {\n    var sensors;\n    var valueMaps;\n\n    const $panelContainer = elem.find('.panel-container');\n\n    function pixelStrToNum(str) {\n        return parseInt(str.substr(0,str.length-2));\n    }\n\t\n    function render() {\n        if (!ctrl.panel.sensors) { return; }\n\t\n        var width = pixelStrToNum($panelContainer.css(\"width\"));\n        var height = pixelStrToNum($panelContainer.css(\"height\"));\n\t  \n        sensors = ctrl.panel.sensors;\t  \n\tvalueMaps = ctrl.panel.valueMaps;\n\t  \n\tvar sensorsLength = sensors.length;\n\tvar valueMapsLength = valueMaps.length;\n\t  \n\tfor (var sensor=0;sensor<sensorsLength;sensor++) {\n            sensors[sensor].visible = sensors[sensor].xlocation<width && sensors[sensor].ylocation<height;\n            sensors[sensor].ylocationStr=sensors[sensor].ylocation.toString()+\"px\";\n            sensors[sensor].xlocationStr=sensors[sensor].xlocation.toString()+\"px\";\n            sensors[sensor].sizeStr=sensors[sensor].size.toString()+\"px\";\n            for (var valueMap=0;valueMap<valueMapsLength;valueMap++) {\t\n                if (sensors[sensor].name==valueMaps[valueMap].name) {\n                    sensors[sensor].valueFormatted = kbn.valueFormats[sensors[sensor].format](valueMaps[valueMap].value,sensors[sensor].decimals, null);\n\t\tbreak;\n\t\t}\n            }\n\t}\n    }\n\n    this.events.on('render', function() {\n      render();\n      ctrl.renderingCompleted();\n    });\n  }\n}\n\nPictureItCtrl.templateUrl = 'module.html';\n"]}